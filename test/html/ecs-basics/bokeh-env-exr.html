<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>XTest-Env Map &amp Bokeh</title>
	<script type='text/javascript' src='../../../dist/xv-0.3.0.min.js'></script>
</head>
<body>
  <canvas id='canv'></canvas><br>
  <img src='assets/../../assets/tex/bricks.jpg' style="width: 256px; margin-left: 257px"/>
  <script>
	"use strict";

	var equirectex = '../../assets/tex/bricks.jpg';

	const xworld = new xv.XWorld(document.getElementById('canv'),
				window,
				{ canvasize: [720, 360],
				  camera: {
					  far: 4000,
					  bokeh: 1.0,
				  },
				  light:{
					  skyColor: 0xffffff,
					  flare: 0.0,
				  },
				  finalQuad: {
					  blurRadius: 1,
					  blurIntense: 1.0,
					  debug: false },
				} );
	const ecs = xworld.xecs;
	const xscene = xworld.xscene;

	xworld.addEntities([
	  { id: 'sky',
		Obj3: { },
		Visual:{vtype: xv.AssetType.skyBox,
				paras: {
					u_tex: equirectex // string for equirectangle map
				}
			}
	  },
	]);

	let ets = [];
	for (let i = 0; i < 18; i++) {
		ets.push(
		  { id: `orb-${i}`,
			Obj3: { geom: xv.XComponent.Obj3Type.SPHERE,
	                box: [40, 24, 24],
					transform: [ { translate: [180 - i * i / 8. * 60, 30 * i, - i * 120] }]
				},
			Visual:{vtype: xv.AssetType.mesh_basic,
					shader: xv.ShaderFlag.envMap,
					paras: {
						whiteAlpha: 1.2,
						envMap: 'sky',
						envExposure: 1.0,   // > 0,  = 1 will keep original
						// lod of cube texture, [refract, reflect], >= 0
						lod: [0.8, 0],
					},
					asset: equirectex
				}
		  });
	}
	xworld.addEntities(ets);

	xworld.startUpdate();

  </script>
</body>
</html>
