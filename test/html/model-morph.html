<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>XTest-Morph</title>
	<script type='text/javascript' src='../../node_modules/three/build/three.min.js'></script>
	<script type='text/javascript' src='../../dist/xv-0.1.0.min.js'></script>
</head>
<body>
  <canvas id='canv'></canvas>
  <script>
	"use strict";

	/**Senario: suppose you have 2 models to be morphed (animated). */
	// initiating xworld
	const xworld = new xv.XWorld(document.getElementById('canv'),
						window, {canvasize: [480, 320]});
	const ecs = xworld.xecs;
	const xscene = xworld.xscene;

	const ent1 = {
		id: 'entity1',
		Obj3: { geom: xv.XComponent.Obj3Type.BOX,
				box: [200, 120, 80],	// bounding box
				// mesh is inited by thrender, can be ignored here - MorphSwitch's target
				mesh: undefined },
		Visual:{vtype: xv.AssetType.mesh,
				asset: 'tex/byr0.png' },
		ModelSeqs: {
			script: [[{ mtype: xv.XComponent.AnimType.ALPHA,
						paras: {start: 0,		// auto start
								duration: 1.2,	// seconds
								alpha: [0.05, 0.90],	// from, to
		 						ease: xv.XEasing.Elastic.In}
					  },
					  { mtype: xv.XComponent.AnimType.GL_VERTS_TRANS,// TODO docs
						paras: {start: Infinity,
								duration: 2,
								src: 'entity1',		// entity1.Obj3.mesh
								dest: 'entity2',	// entity2.Obj3.mesh
								followBy: [{entity: 'points',
											idx: 0}]}	// index of the fade-in
					  }],
					 [{ mtype: xv.XComponent.AnimType.ALPHA,
						paras: {start: 0,
								alpha: [0.95, 0.05],
								ease: undefined }}]
					] },
		CmpTweens: {
			// TODO docs: here are some twenn seq already defined by user.
			// Any newly animized tween sequences will be appended to it.
			// twindx is 1D array, tweens is a 2D array.
			// example: xv.ecs.sys.tween.MorphingAnim.initTweens()
			twindx: [],	// e.g. twindex[0] is 0, script[0] current is 0, created by animizer
			tweens: []}	// initialized by animizer, handled by XTweener. [] is safely ignored
	};
	const entities = xworld.addEntities(ent1);

	const points = {
		id: 'points',
		Obj3: { geom: xv.XComponent.Obj3Type.POINTS,
				box: undefined,		// not used for points
				mesh: undefined,	// THREE.Points
			 	invisible: true },	// It's visible, but alpha 0?
		Visual:{vtype: xv.AssetType.mesh,
				asset: undefined },
		ModelSeqs: {
			script: [[{ mtype: xv.XComponent.AnimType.ALPHA,
						paras: {start: Infinity,	// triggered by entity1
								duration: 1.2,		// seconds
								alpha: [0.06, 0.92],	// from, to
		 						ease: xv.XEasing.Elastic.In} },
					  { mtype: xv.XComponent.AnimType.GL_VERTS_TRANS,// TODO docs
					 	paras: {start: Infinity,	// follow previous
								duration: 1.2,		// seconds
								// src: 'entity2',		// entity1.Obj3.mesh
								dest: 'entity1',	// entity2.Obj3.mesh
								followBy: [{entity: 'entity2',
											idx: 0,	// index of the fade-in
											start: 2000}]} },
					  { mtype: xv.XComponent.AnimType.ALPHA,
						paras: {start: Infinity,	// triggered by entity1
								duration: 1.2,		// seconds
								alpha: [0.9, 0.05],	// from, to
		 						ease: xv.XEasing.Elastic.In} }
				   ]] },
		CmpTweens: {
			// TODO docs: here are some twenn seq already defined by user.
			// Any newly animized tween sequences will be appended to it.
			// twindx is 1D array, tweens is a 2D array.
			// example: xv.ecs.sys.tween.MorphingAnim.initTweens()
			twindx: [],	// e.g. twindex[0] is 0, script[0] current is 0, created by animizer
			tweens: []}	// initialized by animizer, handled by XTweener. [] is safely ignored
	};
	entities.push(... xworld.addEntities(points));

	const ent2 = {
		id: 'entity2',
		Obj3: { geom: xv.XComponent.Obj3Type.PLANE,
				box: [210, 200, 0],	// bounding box
				mesh: undefined },
		Visual:{vtype: xv.AssetType.mesh,
				asset: 'city/textures/World_ap_baseColor.jpeg' },
		ModelSeqs: {
			script: [[{ mtype: xv.XComponent.AnimType.ALPHA,
						paras: {start: 0,		// auto start
								duration: 1.2,	// seconds
								alpha: [0.05, 0.90],	// from, to
		 						ease: xv.XEasing.Elastic.In}
					 }],
					 [{ mtype: xv.XComponent.AnimType.ALPHA,
						paras: {start: 0,
								alpha: [0.95, 0.05],
								ease: undefined }}]
					]},
		CmpTweens: {
			twindx: [],	// e.g. twindex[0] is 0, script[0] current is 0, created by animizer
			tweens: []}	// initialized by animizer, handled by XTweener. [] is safely ignored
	};
	entities.push(... xworld.addEntities(ent2));

	xworld.startUpdate();

	entities[0].ModelSeqs.script[0][0].paras.start = 0;
  </script>
</body>
</html>
