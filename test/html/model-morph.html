<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>XTest-Morph</title>
	<script type='text/javascript' src='../../node_modules/three/build/three.min.js'></script>
	<script type='text/javascript' src='../../dist/xv-0.1.0.min.js'></script>
</head>
<body>
  <canvas id='canv'></canvas>
  <script>
	"use strict";

	/**Senario: suppose you have 2 models to be morphed (animated). */
	// initiating xworld
	const xworld = new xv.XWorld(document.getElementById('canv'),
						window, {canvasize: [480, 320]});
	const ecs = xworld.xecs;
	const xscene = xworld.xscene;

	const def1 = {
		id: 'entity1',
		Obj3: { geom: xv.XComponent.Obj3Type.BOX,
				box: [200, 120, 80],	// bounding box
				// mesh is inited by thrender, can be ignored here - MorphSwitch's target
				mesh: undefined },
		Visual:{vtype: xv.AssetType.mesh,
				asset: 'byr0.png' },
		ModelSeqs: {
			script: [[{ mtype: xv.Compoents.AnimType.FADEOUT,
						paras: {start: 0}},		// auto start, only alpha tween in 0.1
					  { mtype: AnimType.POINTS,
					 	paras: {
							src: 'entity1',		// entity1.Obj3.mesh
							dest: 'entity2',	// entity2.Obj3.mesh
							followBy: { entity: 'entity2',
										script: 'fade-in'}}
					  }],
					 [{ mtype: xv.Compoents.AnimType.FADEIN,
						name: 'fade-in',
						paras: {}}				// only alpha tween in 0.1
					]] },
		CmpTween: undefined
	};
	const entities = xworld.addEntities(def1);

	const def2 = {
		id: 'entity2',
		// TODO test with a loaded model
		Obj3: { geom: xv.XComponent.Obj3Type.PLANE,
				box: [240, 100, 0],	// bounding box
				// mesh is inited by thrender, can be ignored here - MorphSwitch's target
				mesh: undefined },
		Visual:{vtype: xv.AssetType.mesh,
				asset: 'textures/World_ap_baseColor.png' }
		ModelSeqs: {
			script: [[{ mtype: xv.Compoents.AnimType.FADEIN,
						name: 'fade-in',
						paras: {}} ],			// only alpha tween in 0.1
					 [{ mtype: xv.Compoents.AnimType.FADEOUT,
						paras: {cmd: 'w'}},		// start by 'w'
					  { mtype: AnimType.POINTS,
					 	paras: {
							src: 'entity2',		// entity1.Obj3.mesh
							dest: 'entity1',	// entity2.Obj3.mesh
							followBy: { entity: 'entity1',
										script: 'fade-in'}}
					  } ]] },
		CmpTween: undefined
	};
	entities.push(... xworld.addEntities(def2));

	const morphsys = new xv.Morph(ecs, { xscene });
	xworld.addSystem('test', morphsys);
	xworld.startUpdate();

	morphsys.start('entity1');
  </script>
</body>
</html>
