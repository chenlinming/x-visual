<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>XTest-Morph</title>
	<script type='text/javascript' src='../../node_modules/three/build/three.min.js'></script>
	<script type='text/javascript' src='../../dist/xv-0.1.0.min.js'></script>
</head>
<body>
  <canvas id='canv'></canvas>
  <script>
	"use strict";

	/**Senario: suppose you have 2 models to be morphed (animated). */
	// initiating xworld
	const defs = [];
	defs.push({
		id: 'ent1',
		Obj3: { geom: xv.XComponent.Obj3Type.BOX,
				box: [200, 120, 80],	// bounding box
				// mesh is inited by thrender, can be ignored here - MorphSwitch's target
				mesh: undefined,
			 	uniforms: {opacity: 0.9}},
		Visual:{vtype: xv.AssetType.mesh,// TODO path / line
				paras: {tex_alpha: 0.9},
				asset: 'tex/crosstar.png' },
	});

	defs.push({
		id: 'ent2',
		Obj3: { geom: xv.XComponent.Obj3Type.BOX,
				box: [260, 40, 200],	// bounding box
				mesh: undefined,
				invisible: true,
			 	uniforms: {opacity: 0.1}},
		Visual:{vtype: xv.AssetType.mesh,// TODO path / line
				paras: {alpha: 0.001},
				asset: null },
	});

	defs.push({
		id: 'points',
		Obj3: { geom: xv.XComponent.Obj3Type.NA,	// use the geometry of ent1
				box: [200, 2, 1],
				mesh: undefined,					// THREE.Points
			 	invisible: false },					// It's visible, but alpha 0?
		Visual:{vtype: xv.AssetType.cubeVoxel,
				asset: 'ent1',
				shader: xv.XComponent.ShaderFlag.cubeVoxels,
				paras: {vert_scale: '30.0',
						uniforms:{u_cubes: ['ent1', 'ent2'],	// ent2.Obj3.mesh, matrix, etc.
								  u_sects: [5, 6, 7],			// sections in x, y, z
								  u_tex: 'tex/spark1.png' } }},
		ModelSeqs: {
			script: [[{ mtype: xv.XComponent.AnimType.U_VERTS_TRANS,
						paras: {start: 0,
								duration: 0.8,
								uniforms: { u_morph: [0, 0.4],
											a_noise: [0, 3] },
		 						ease: xv.XEasing.Elastic.In} },
					  { mtype: xv.XComponent.AnimType.U_VERTS_TRANS,
						paras: {start: 0.2,
								duration: 0.8,
								uniforms: { u_morph: [0.4, 1],
											a_noise: [3, 0.02] },
		 						ease: xv.XEasing.Elastic.In} },
					  { mtype: xv.XComponent.AnimType.U_VERTS_TRANS,
						paras: {start: 2,
								duration: 1.2,
								uniforms: { u_morph: [1.0, 0],
											a_noise: [0.2, 0.02] },
		 						ease: xv.XEasing.Elastic.In},
						followBy: [{entity: 'points',
									seqx: 0,		// repeat
									start: 3}] },
					]] },
		CmpTweens: {}
	});

	const xworld = new xv.XWorld(document.getElementById('canv'),
						window, {canvasize: [480, 320]});
	xworld.addEntities(defs);
	xworld.startUpdate();
  </script>
</body>
</html>
