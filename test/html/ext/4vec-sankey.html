<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>XTest.ext - XSankey</title>
    <script type='text/javascript' src='../../node_modules/three/build/three.min.js'></script>
    <script type='text/javascript' src='../../dist/xv-0.2.0.min.js'></script>
</head>
<body>
  <img id='splash'></img>
  <canvas id='canv'></canvas>
  <script>
    "use strict";

    class ChartSankey extends xv.XSys {
        constructor(ecs, options) {
            super(ecs);
            this.ecs = ecs;
            this.initPaths(ecs, options.xworld);
        }

        initSankey(ecs, xworld) {
            var chartConf = {
                id: 'sankey1',
                script: [
                 [{ mtype: xv.XComponent.AnimType.ALPHA,
                    paras: {duration: 1.1,     // seconds
                            alpha: [0.3, 0.9],
                            ease: xv.XEasing.Elastic.In} }],
                 [{ mtype: xv.XComponent.AnimType.ALPHA,
                    paras: {duration: 5.2,
                            alpha: [0.3, 0.9],
                            ease: xv.XEasing.Elastic.In} }],
                    ],
                paras: {
                    data: {file: '../data/sankey1.json'},
                    node: 'box',
                    onOverNode: 0,  // tweens[0]
                    onOverFlow: 1,  // tweens[1]
                    // onClickNode: 2, // onClick is handled by function
                } },

            var sankey = new XSankey(ecs, {chart: chartConf});
            xworld.addSystem('sankey', sankey);
        }
    }

    CustLine.query = { iffall: ['CmdFlag', 'Sankey'] };

    const xworld = new xv.XWorld(document.getElementById('canv'), window,
                                {effects: true});
    const ecs = xworld.xecs;
    const xscene = xworld.xscene;

    xworld.addSystem('test', new ChartSankey(ecs, {xworld}));

    xworld.startUpdate();
  </script>
  </body>
</html>
